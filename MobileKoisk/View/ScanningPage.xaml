<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            xmlns:viewmodel="clr-namespace:MobileKoisk.ViewModel"
             xmlns:zxing="clr-namespace:ZXing.Net.Maui.Controls;assembly=ZXing.Net.MAUI.Controls"
             x:Class="MobileKoisk.View.ScanningPage"
             x:DataType="viewmodel:ScanningViewModel"
            >
    
    <!--Layout-->
    <Grid RowDefinitions="auto, *"  ColumnDefinitions="*,*" >

        <!--Header Title-->

        <StackLayout  Grid.Row="0" 
                      Grid.ColumnSpan="2"
                >

            <Frame BackgroundColor="{StaticResource yellow}"
                     HasShadow="True"
                     HeightRequest="70"
                     BorderColor="{StaticResource yellow}"
                     CornerRadius="0"
                 >

                <HorizontalStackLayout   HeightRequest="40" Spacing="-20"  VerticalOptions="Center"  HorizontalOptions="Center" >
                    <Label Text="Scan Barcode"
                                    FontFamily="PoppinsBold"
                                    FontAttributes="Bold"
                       
                                    FontSize="27"
                        
                                    TextColor="{StaticResource White}"
                             />
                   
                </HorizontalStackLayout>






            </Frame>
        </StackLayout>
        <!--The body-->
        <Grid Grid.Row="1"
              Grid.ColumnSpan="2"
              Padding="20"
              >
            
            <Border 
                    StrokeShape="RoundRectangle 10"
                    Stroke="{StaticResource PrimaryDark}"
                    StrokeThickness="1"
                    Margin="0,10">
                                   
               
                  
                
            </Border>

            <!-- Scan Status -->
            <VerticalStackLayout Grid.Row="2"
                                 Spacing="10"
                                 Margin="0,10">
                
                <Label Text="Binding scanStatus"
                       HorizontalOptions="Center"
                        FontSize="16"/>
                
            </VerticalStackLayout>

            <!-- Product Details card -->
            <Border  StrokeShape="RoundRectangle 10"
                     BackgroundColor="{AppThemeBinding Light={StaticResource NavigationBarTextColor}, Dark={StaticResource NavigationBarTextColor}}"
                     Padding="0"
                     Stroke="{StaticResource PrimaryDark}"
                    Margin="0,10">
                
                <Grid>
                    
                <!-- cameras -->
                    <zxing:CameraBarcodeReaderView  HorizontalOptions="Fill"
                                                    VerticalOptions="Fill"
                                                    x:Name="cameraBarcodeReaderView"
                                                    IsDetecting="{Binding IsScanning, Converter={StaticResource InverseBoolConverter}}"
                                                    Options="{Binding ReaderOptions}"
                                                    BarcodesDetected="OnBarcodeDetected" />
                </Grid>
            </Border>

            <!-- Control Buttuns-->
            <HorizontalStackLayout Grid.Row="1"                                 
                                   Spacing="10"
                                   Margin="0 ,20"
                                   VerticalOptions="Start"
                                   HorizontalOptions="Center">
                
                <Button Text="Scan Barcode"
                        FontFamily="PoppinsBold"
                        Command="{Binding StartScanningCommand}"
                        IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBoolConverter}}"                       
                        HeightRequest="50"   
                        WidthRequest="150"/>
                
                
                <Button Text="Enter Barcode"
                        TextColor="{StaticResource PrimaryDarkText}"
                        Command="{Binding OpenManualEntryCommand}"
                        IsEnabled="False"
                        FontFamily="PoppinsBold"
                        HeightRequest="50"
                        WidthRequest="150"/>

            </HorizontalStackLayout>
        </Grid>

        <!-- Manual Entry Popup (Add this at the end of the Grid) -->
        <Grid Grid.RowSpan="2"
              Grid.ColumnSpan="2"
              IsVisible="{Binding ShowManualEntry}"
              BackgroundColor="#80000000"
              InputTransparent="False">

            <Border HorizontalOptions="Center"
                    VerticalOptions="Center"
                    StrokeShape="RoundRectangle 10"
                    BackgroundColor="{StaticResource NavigationBarTextColor}"
                    Padding="20,30"
                    StrokeThickness="0">

                <VerticalStackLayout Spacing="20" WidthRequest="300">
                    <Label Text="Enter Barcode"
                           FontFamily="PoppinsBold"
                           FontSize="20"
                           HorizontalOptions="Center"/>

                    <Entry x:Name="barcodeEntry"
                           Text="{Binding ManualBarcode}"
                           Placeholder="123456789012"
                           Keyboard="Numeric"
                           MaxLength="13"
                           FontSize="18"
                           HorizontalTextAlignment="Center"/>

                    <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                        <Button Text="Cancel"
                                FontFamily="PoppinsBold"
                                Command="{Binding CloseManualEntryCommand}"
                                BackgroundColor="{StaticResource gray200}"
                                TextColor="{StaticResource PrimaryDarkText}"
                                WidthRequest="100"/>

                        <Button Text="OK"
                                FontFamily="PoppinsBold"
                                Command="{Binding ConfirmManualEntryCommand}"
                                BackgroundColor="{StaticResource yellow}"
                                TextColor="{StaticResource White}"
                                WidthRequest="100"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>
        </Grid>
        

    </Grid>
</ContentPage>